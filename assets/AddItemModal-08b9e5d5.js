import{c as te,r as c,j as t,B as x,F as R,S as se,g as L,f as re,a as ae,b as B}from"./index-96b50e80.js";import{S as ie}from"./search-e44da230.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=te("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ne=["Theme Parks","Restaurants","Shopping","Entertainment","Outdoor Activities","Museums","Sports","Nightlife","Other"],le=["low","medium","high"];function me({onClose:N,onAdd:M,userLocation:w}){const[a,A]=c.useState({title:"",description:"",address:"",category:"Other",priority:"medium",estimatedDuration:60,cost:0,notes:"",isOpen:!0}),[u,S]=c.useState(null),[P,$]=c.useState(!1),[l,y]=c.useState({}),[T,v]=c.useState({}),[E,D]=c.useState(!1),[O,C]=c.useState(null),[H,k]=c.useState(!1),[V,I]=c.useState(null),[_,b]=c.useState([]),[q,F]=c.useState(!1),[z,W]=c.useState(null);c.useEffect(()=>{w&&S({lat:w.lat,lng:w.lng})},[w]);const g=e=>{const{name:s,value:r}=e.target;A(i=>({...i,[s]:s==="estimatedDuration"||s==="cost"?Number(r):r})),l[s]&&y(i=>({...i,[s]:""}))},U=async()=>{if(!a.address.trim()){y(e=>({...e,address:"Please enter an address"}));return}$(!0);try{const e=await L(a.address);e?(S(e),y(s=>({...s,address:""}))):y(s=>({...s,address:"Address not found. Please try a different address."}))}catch{y(e=>({...e,address:"Error searching for address. Please try again."}))}finally{$(!1)}},X=e=>{g(e);const s=e.target.value;if(z&&clearTimeout(z),!s.trim()){b([]);return}const r=setTimeout(async()=>{try{if(G()){b([]);return}F(!0);const i=await re(s);b(i)}catch{b([])}finally{F(!1)}},300);W(r)},Y=async e=>{var s;try{if(G())return;F(!0);const r=await ae(e.place_id),i=r.name||a.title,m=r.formatted_address||e.description;let o=u;r.geometry&&r.geometry.location&&(o={lat:r.geometry.location.lat,lng:r.geometry.location.lng});let d=a.description;r.editorial_summary&&r.editorial_summary.overview?d=r.editorial_summary.overview:r.types&&r.types.length&&(d=r.types.map(p=>p.replace(/_/g," ")).join(", "));const h={},j=r.opening_hours&&Array.isArray(r.opening_hours.periods)?r.opening_hours.periods:[];for(let p=0;p<7;p++){const n=j.find(f=>f.open.day===p);n?h[p]={open:n.open.time.replace(/(\d{2})(\d{2})/,"$1:$2"),close:(s=n.close)!=null&&s.time?n.close.time.replace(/(\d{2})(\d{2})/,"$1:$2"):""}:h[p]=null}A(p=>({...p,title:i,address:m,description:d})),S(o),v(h),b([])}finally{F(!1)}},J=()=>{const e={};return a.title.trim()||(e.title="Title is required"),a.description.trim()||(e.description="Description is required"),u||(e.address="Please select a valid location"),a.estimatedDuration<=0&&(e.estimatedDuration="Duration must be greater than 0"),a.cost<0&&(e.cost="Cost cannot be negative"),y(e),Object.keys(e).length===0},K=e=>{if(e.preventDefault(),!J())return;if(!u){y(r=>({...r,address:"Please select a valid location"}));return}const s={title:a.title.trim(),description:a.description.trim(),location:u,address:a.address.trim(),category:a.category,priority:a.priority,estimatedDuration:a.estimatedDuration,cost:a.cost,notes:a.notes.trim(),isOpen:a.isOpen,openingHours:T};M(s)},Q=async()=>{var e;D(!0),C(null);try{const{title:s,address:r}=a;if(!s.trim()||!r.trim()){C("Please enter both a title and address first."),D(!1);return}const i=await B(s,r);if(i.opening_hours&&i.opening_hours.periods){const m={};for(let o=0;o<7;o++){const d=i.opening_hours.periods.find(h=>h.open.day===o);d?m[o]={open:d.open.time.replace(/(\d{2})(\d{2})/,"$1:$2"),close:(e=d.close)!=null&&e.time?d.close.time.replace(/(\d{2})(\d{2})/,"$1:$2"):""}:m[o]=null}v(m)}else C("No opening hours found for this place.")}catch(s){const r=s instanceof Error?s.message:String(s);C("Failed to fetch hours: "+r)}finally{D(!1)}},Z=async()=>{var e;k(!0),I(null);try{const{title:s,address:r}=a;if(!s.trim()&&!r.trim()){I("Please enter at least a title or address."),k(!1);return}const i=await B(s,r),m=i.name||a.title,o=i.formatted_address||a.address;let d=a.description;i.editorial_summary&&i.editorial_summary.overview?d=i.editorial_summary.overview:i.types&&i.types.length&&(d=i.types.map(n=>n.replace(/_/g," ")).join(", "));let h=u;if(i.geometry&&i.geometry.location)h={lat:i.geometry.location.lat,lng:i.geometry.location.lng};else if(o&&!u){const n=await L(o);n&&(h=n)}const j={},p=i.opening_hours&&Array.isArray(i.opening_hours.periods)?i.opening_hours.periods:[];for(let n=0;n<7;n++){const f=p.find(ee=>ee.open.day===n);f?j[n]={open:f.open.time.replace(/(\d{2})(\d{2})/,"$1:$2"),close:(e=f.close)!=null&&e.time?f.close.time.replace(/(\d{2})(\d{2})/,"$1:$2"):""}:j[n]=null}A(n=>({...n,title:m,address:o,description:d})),S(h),v(j)}catch(s){const r=s instanceof Error?s.message:String(s);I("Failed to auto-populate: "+r)}finally{k(!1)}},G=()=>{var r;const s=(r=navigator.connection)==null?void 0:r.effectiveType;return s==="2g"||s==="slow-2g"||s==="3g"};return t.jsx("div",{className:"modal",onClick:N,children:t.jsxs("div",{className:"modal-content",role:"dialog","aria-modal":"true","aria-labelledby":"add-activity-title",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{id:"add-activity-title",children:"Add New Activity"}),t.jsx(x,{className:"close-button",variant:"ghost","aria-label":"Close",onClick:N,children:t.jsx(oe,{size:24})})]}),t.jsxs("form",{onSubmit:K,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"title",children:"Title *"}),t.jsx("input",{type:"text",id:"title",name:"title",value:a.title,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:`scroll-into-view ${l.title?"error":""}`,placeholder:"e.g., Visit Disney World","aria-label":"Activity title"}),l.title&&t.jsx("span",{className:"error-text",children:l.title})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"description",children:"Description *"}),t.jsx("textarea",{id:"description",name:"description",value:a.description,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:`scroll-into-view ${l.description?"error":""}`,placeholder:"Describe what you want to do...",rows:3,"aria-label":"Activity description"}),l.description&&t.jsx("span",{className:"error-text",children:l.description})]}),t.jsx(R,{id:"address",label:"Address",required:!0,error:l.address,children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx("input",{type:"text",name:"address",value:a.address,onChange:X,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:"scroll-into-view",placeholder:"Enter address or search for location",style:{flex:1},"aria-autocomplete":"list","aria-expanded":_.length>0}),t.jsx(x,{type:"button",onClick:U,disabled:P,"aria-label":"Search for address",variant:"primary",size:"md",children:P?"...":t.jsx(ie,{size:16})})]})}),q&&t.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"Searching..."}),_.length>0&&t.jsx("ul",{style:{listStyle:"none",marginTop:"0.5rem",border:"1px solid #e5e7eb",borderRadius:6,maxHeight:200,overflowY:"auto",background:"white"},role:"listbox",children:_.map(e=>t.jsx("li",{style:{padding:"0.5rem 0.75rem",cursor:"pointer"},onClick:()=>Y(e),role:"option","aria-selected":"false",children:e.description},e.place_id))}),u&&t.jsxs("p",{style:{fontSize:"0.75rem",color:"#10b981",marginTop:"0.25rem"},children:["ðŸ“ Location set: ",u.lat.toFixed(6),", ",u.lng.toFixed(6)]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"category",children:"Category"}),t.jsx("select",{id:"category",name:"category",value:a.category,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:"scroll-into-view","aria-label":"Activity category",children:ne.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"priority",children:"Priority"}),t.jsx("select",{id:"priority",name:"priority",value:a.priority,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:"scroll-into-view","aria-label":"Activity priority",children:le.map(e=>t.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"estimatedDuration",children:"Duration (minutes) *"}),t.jsx("input",{type:"number",id:"estimatedDuration",name:"estimatedDuration",value:a.estimatedDuration,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:`scroll-into-view ${l.estimatedDuration?"error":""}`,min:"1","aria-label":"Activity estimated duration"}),l.estimatedDuration&&t.jsx("span",{className:"error-text",children:l.estimatedDuration})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"cost",children:"Estimated Cost ($)"}),t.jsx("input",{type:"number",id:"cost",name:"cost",value:a.cost,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:`scroll-into-view ${l.cost?"error":""}`,min:"0",step:"0.01","aria-label":"Activity estimated cost"}),l.cost&&t.jsx("span",{className:"error-text",children:l.cost})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"checkbox",id:"isOpen",name:"isOpen",checked:a.isOpen,onChange:e=>A(s=>({...s,isOpen:e.target.checked})),"aria-label":"Is activity currently open"}),t.jsx("span",{children:"ðŸŸ¢ This place is currently open"})]}),t.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"Uncheck if the place is closed or you want to mark it as unavailable"})]}),t.jsx(R,{id:"notes",label:"Additional Notes",children:t.jsx("textarea",{name:"notes",value:a.notes,onChange:g,onFocus:e=>e.currentTarget.scrollIntoView({behavior:"smooth",block:"center"}),className:"scroll-into-view",placeholder:"Any additional details...",rows:2})}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Opening Hours"}),t.jsx(x,{type:"button",onClick:Q,disabled:E,style:{marginLeft:8},"aria-label":"Fetch opening hours from Google",variant:"neutral",size:"sm",children:E?"Fetching...":"Auto-populate from Google"}),O&&t.jsx("span",{className:"error-text",children:O}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.5rem",marginTop:8},children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((e,s)=>{var r,i;return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[t.jsx("span",{style:{fontWeight:500},children:e}),t.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[t.jsx("input",{type:"time",value:((r=T[s])==null?void 0:r.open)||"",onChange:m=>v(o=>({...o,[s]:{...o[s]||{},open:m.target.value}})),"aria-label":`Open time for ${e}`}),t.jsx("span",{children:"-"}),t.jsx("input",{type:"time",value:((i=T[s])==null?void 0:i.close)||"",onChange:m=>v(o=>({...o,[s]:{...o[s]||{},close:m.target.value}})),"aria-label":`Close time for ${e}`})]})]},e)})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx(x,{type:"button",onClick:Z,disabled:H,style:{marginBottom:8},"aria-label":"Auto-populate all fields from Google",variant:"neutral",size:"sm",children:H?"Auto-populating...":"Auto-populate All Fields from Google"}),V&&t.jsx("span",{className:"error-text",children:V})]}),t.jsxs(se,{children:[t.jsx(x,{type:"button",variant:"neutral",onClick:N,"aria-label":"Cancel adding activity",children:"Cancel"}),t.jsx(x,{type:"submit",variant:"primary","aria-label":"Add activity",children:"Add Activity"})]})]})]})})}export{me as default};
